<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Farzad" />

<meta name="date" content="2016-08-15" />

<title>NARX Model Guide</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="libs/highlight/default.css"
      type="text/css" />
<script src="libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="fluid-row" id="header">



<h1 class="title toc-ignore">NARX Model Guide</h1>
<h4 class="author"><em>Farzad</em></h4>
<h4 class="date"><em>15 August 2016</em></h4>

</div>


<div id="setup" class="section level2">
<h2>Setup</h2>
<p>For the rest of this guide, we will use time-series <code>ausbeer</code> from package <code>fpp</code>:</p>
<pre class="r"><code>library(&quot;fpp&quot;)

beer_train = head(ausbeer, -20)
beer_test = head(tail(ausbeer, 20), 10)</code></pre>
</div>
<div id="narx-model" class="section level2">
<h2>NARX Model</h2>
<p>A simple NARX model can be crafted using <code>narx</code>. A model with</p>
<ul>
<li>differencing order <code>d=0</code></li>
<li>auto-regressive order <code>p=2</code></li>
<li>seasonal frequency <code>freq=4</code></li>
<li>seasonal differencing order <code>D=1</code></li>
<li>seasonal order <code>P=1</code></li>
<li><code>svm</code> learner</li>
</ul>
<p>can be instantiated as follows:</p>
<pre class="r"><code>library(&quot;mltsp&quot;)
library(&quot;e1071&quot;)
spec = build_narx(svm, p=2, d=0, P=1, D=1, freq=frequency(ausbeer))
model = narx(spec, beer_train)

model</code></pre>
<pre><code>## NARX svm(2, 0)(1, 1)[4]</code></pre>
<p>or alternatively:</p>
<pre class="r"><code>model = narx(beer_train, svm, p=2, d=0, P=1, D=1, freq=frequency(ausbeer))</code></pre>
</div>
<div id="duplicating-the-model" class="section level2">
<h2>Duplicating the model</h2>
<p>One could re-instantiate the model for use with another dataset using</p>
<pre class="r"><code>beer_train2 = head(ausbeer, -10)

model2 = narx(model, beer_train2)</code></pre>
</div>
<div id="prediction" class="section level2">
<h2>Prediction</h2>
<p>Prediction uses either <code>forecast</code> (compatible with package <code>forecast</code>):</p>
<pre class="r"><code>fcst = forecast(model, h = 10)
plot(fcst)
lines(beer_test, col=&quot;red&quot;)</code></pre>
<p><img src="narx_guide_files/figure-html/testnarx-1.png" width="672" /></p>
<p>or use <code>predict</code> if you want to also supply new data but use the same model:</p>
<pre class="r"><code>beer_train2 = head(ausbeer, -10) # this is using data from another future!
beer_test2 = tail(ausbeer, 10) # this is using data from another future!

fcst2 = predict(model, beer_train2, h = 10)

plot(ausbeer)
lines(beer_test2, col=&quot;red&quot;)
lines(fcst2, col=&quot;blue&quot;)</code></pre>
<p><img src="narx_guide_files/figure-html/testnarx2-1.png" width="672" /></p>
<p>Alternatively, one could reuse the model using</p>
<pre class="r"><code>model2 = narx(model, beer_train2)
fcst3 = forecast(model2, h = 10)

plot(fcst3)
lines(fcst2, col=&quot;red&quot;)</code></pre>
<p><img src="narx_guide_files/figure-html/testnarx3-1.png" width="672" /></p>
</div>
<div id="using-exogenous-data" class="section level2">
<h2>Using exogenous data</h2>
<p>Use <code>xreg</code> parameter as exogenous data. This example tries to forecast a random walk. Without xreg, this should be almost impossible:</p>
<pre class="r"><code>set.seed(0)

tstamps = seq(as.Date(&quot;2000-01-01&quot;), length.out = 110, by=&#39;day&#39;)
x = xts(runif(length(tstamps)), tstamps)
xreg = 1 - 0.5 * x
yreg = xts(runif(110), tstamps)

colnames(xreg) = colnames(yreg) = &quot;xreg&quot;

# training and testing data
x_train = head(x, 100)
x_test = tail(x, 10)
ind_test = index(x_test)</code></pre>
<p>For simplicity, we use <code>SimpleLM</code> as the learner, which is a simple wrapper for <code>lm</code>. * <code>lm</code> is not compatible with <code>narx</code> as it requires a formula. <code>SimpleLM</code> allows using a linear model without resorting to crafting formulas, similar to what <code>svm</code> from package <code>e1071</code> does.</p>
<p>Model one, without <code>xreg</code>:</p>
<pre class="r"><code>model = narx(x_train, SimpleLM, p = 2)
pred1 = forecast(model, h=10)</code></pre>
<p>Model two, with correlated (good) <code>xreg</code>:</p>
<pre class="r"><code>model2 = narx(x_train, SimpleLM, p = 2, xreg = xreg)
pred2 = forecast(model2, xreg=xreg[ind_test])</code></pre>
<p>Model three, with an uncorrelated (bad) <code>xreg</code>:</p>
<pre class="r"><code>model3 = narx(x_train, SimpleLM, p = 2, xreg = yreg)
pred3 = forecast(model3, xreg=yreg[ind_test])</code></pre>
<p>The results:</p>
<pre class="r"><code>rmse &lt;- function(x,y) sqrt(mean((x-y)^2))

c(Err_without_xreg= rmse(pred1$mean, x_test),
  Err_with_xreg= rmse(pred2$mean, x_test),
  Err_with_bad_xreg= rmse(pred3$mean, x_test))</code></pre>
<pre><code>##  Err_without_xreg     Err_with_xreg Err_with_bad_xreg 
##      2.755231e-01      1.570092e-16      2.985320e-01</code></pre>
<p>The smallest error is obtained from the model with correlated <code>xreg</code>.</p>
<div id="notes" class="section level3">
<h3>Notes</h3>
<ul>
<li>Some ML models, such as <code>SimpleLM</code>, require the same column names in training and testing to fit data.</li>
<li>Instead of <code>h</code> as the forecast horizon, <code>xreg</code> and its time-stamps are used.</li>
</ul>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
